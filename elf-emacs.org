#+title: GNU Emacs configuration for Emacs 30 and above
#+author: Владимир Рязанцев
#+email: russian.doll.36@yandex.ru
#+language: ru
#+options: ':t toc:nil num:nil author:t email:t

* Emacs30

* early-init.el
:PROPERTIES:
  :header-args:emacs-lisp: :tangle ~/.emacs.d/early-init.el
  :ID: early-init
:END:

* init.el
:PROPERTIES:
:header-args:emacs-lisp: :tangle ~/.emacs.d/init.el :mkdirp yes
:ID: init
:END:
** Пакетны мененжер
#+begin_src emacs-lisp
  (require 'package)
  (add-to-list 'package-archives '("melpa-stable" . "http://stable.melpa.org/packages/") t)
  (add-to-list 'package-archives '("melpa" . "http://melpa.org/packages/") t)
 ;; (add-to-list 'package-archives '("org" . "http://orgmode.org/elpa/") t)
 ;; (add-to-list 'package-archives '("gnu" . "http://elpa.gnu.org/packages/") t)
 ;; (add-to-list 'package-archives '("elpy" . "https://jorgenschaefer.github.io/packages/") t)

  (require 'use-package)
  (setq use-package-always-ensure t)
#+end_src

** Шрифты
#+begin_src emacs-lisp
    ;;; Шрифты
  (set-face-attribute 'default nil :height 140)
  (when (member "JetBrains Mono" (font-family-list))
    (set-face-attribute 'default nil :font "JetBrains Mono"))
#+end_src

** Убрать всё лишнее
#+begin_src emacs-lisp
  (tool-bar-mode -1)
  (menu-bar-mode -1)
  (scroll-bar-mode -1)
#+end_src

** Сочетание как в windows (C-c C-v)
#+begin_src emacs-lisp
  (cua-mode 1)
#+end_src

** Yes-No укорачиваем ответ
#+begin_src emacs-lisp
  (setq-default use-short-answers t)
#+end_src

** Scratch настройка
#+begin_src emacs-lisp
 
#+end_src

** Увеличьте отступы между рамками и окнами Emacs
#+begin_src emacs-lisp
  (use-package spacious-padding
  :custom
  (line-spacing 3)
  (spacious-padding-mode 1))
#+end_src

** оформление темы
#+begin_src emacs-lisp
  (use-package modus-themes
    :custom
    (modus-themes-italic-constructs t)
    (modus-themes-bold-constructs t)
    (modus-themes-mixed-fonts t)
    (modus-themes-to-toggle '(modus-operandi-tinted
  			    modus-vivendi-tinted))
    :bind
    (("C-c w t t" . modus-themes-toggle)
     ("C-c w t m" . modus-themes-select)
     ("C-c w t s" . consult-theme)))

  (use-package ef-themes)
#+end_src

** Mixed-pitch mode
#+begin_src emacs-lisp
  (use-package mixed-pitch
  :hook
  (org-mode . mixed-pitch-mode))
#+end_src

** Управление окнами
#+begin_src emacs-lisp
  (setq split-width-threshold 120
      split-height-threshold nil)
#+end_src

#+begin_src emacs-lisp
  (use-package balanced-windows
  :config
  (balanced-windows-mode))
#+end_src

** Включить vertico
#+begin_src emacs-lisp
  (use-package vertico
  :init
  (vertico-mode)
  :custom
  (vertico-sort-function 'vertico-sort-history-alpha))
#+end_src

** Поиск частичных совпадений в любом порядке
#+begin_src emacs-lisp
  (use-package orderless
  :custom
  (completion-styles '(orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides
   '((file (styles partial-completion)))))
#+end_src

** более подробные аннотации
#+begin_src emacs-lisp
  (use-package marginalia
  :init
  (marginalia-mode))
#+end_src

** Улучшена возможность обнаружения сочетаний клавиш
#+begin_src emacs-lisp
  (use-package which-key
  :config
  (which-key-mode)
  :custom
  (which-key-max-description-length 40)
  (which-key-lighter nil)
  (which-key-sort-order 'which-key-description-order))

#+end_src

** Контекстное меню с помощью правой кнопки мыши
#+begin_src emacs-lisp
  (when (display-graphic-p)
  (context-menu-mode))
#+end_src

** Улучшенные буферы справки
#+begin_src emacs-lisp
  (use-package helpful
  :bind
  (("C-h f" . helpful-function)
   ("C-h x" . helpful-command)
   ("C-h k" . helpful-key)
   ("C-h v" . helpful-variable)))
#+end_src

** Настройки текстового режима
#+begin_src emacs-lisp
  (use-package text-mode
  :ensure
  nil
  :hook
  (text-mode . visual-line-mode)
  :init
  (delete-selection-mode t)
  :custom
  (sentence-end-double-space nil)
  (scroll-error-top-bottom t)
  (save-interprogram-paste-before-kill t))
#+end_src

** Пороверка орфографии
[[https://ozi-blog.ru/proverka-orfografii-na-letu-v-emacs-hunspell-emacs/][Проверка орфографии на лету в emacs: hunspell + emacs]]
#+begin_src emacs-lisp
  ;;если есть программка hunspell, то используем её для проверки орфографии
  ;;словарь - en-ru
  (if (executable-find "hunspell")
      (progn
        (setq ispell-program-name "hunspell")
        (setq ispell-really-aspell nil)
        (setq ispell-really-hunspell t)
        (setq ispell-dictionary "en-ru")
      )
  )
  ;;режим работы с файлами в emacs по умолчанию - текстовый
  (setq default-major-mode 'text-mode)
  ;;включаем проверку синтаксиса на лету в emacs с помощью flyspell-mode
  (dolist (hook '(text-mode-hook))
    (add-hook hook (lambda () (flyspell-mode 1)))
  )
  ;;назначаем на Ctrl+l интерактивную проверку орфографии
  (global-set-key (kbd "C-l") 'ispell)
#+end_src
** Запуск организационного режима
#+begin_src emacs-lisp
  (use-package org
  :custom
  (org-startup-indented t)
  (org-hide-emphasis-markers t)
  (org-startup-with-inline-images t)
  (org-image-actual-width '(450))
  (org-fold-catch-invisible-edits 'error)
  (org-pretty-entities t)
  (org-use-sub-superscripts "{}")
  (org-id-link-to-org-use-id t)
  (org-fold-catch-invisible-edits 'show))
#+end_src
** Показать скрытые маркеры выделения
#+begin_src emacs-lisp
  (use-package org-appear
  :hook
  (org-mode . org-appear-mode))
#+end_src
** Предварительные просмотры LaTeX
#+begin_src emacs-lisp
  (use-package org-fragtog
  :after org
  :hook
  (org-mode . org-fragtog-mode)
  :custom
  (org-startup-with-latex-preview nil)
  (org-format-latex-options
   (plist-put org-format-latex-options :scale 2)
   (plist-put org-format-latex-options :foreground 'auto)
   (plist-put org-format-latex-options :background 'auto)))
#+end_src
** Современная организация: Большинство функций отключены для начинающих пользователей
#+begin_src emacs-lisp
  (use-package org-modern
  :hook
  (org-mode . org-modern-mode)
  :custom
  (org-modern-table nil)
  (org-modern-keyword nil)
  (org-modern-timestamp nil)
  (org-modern-priority nil)
  (org-modern-checkbox nil)
  (org-modern-tag nil)
  (org-modern-block-name nil)
  (org-modern-keyword nil)
  (org-modern-footnote nil)
  (org-modern-internal-target nil)
  (org-modern-radio-target nil)
  (org-modern-statistics nil)
  (org-modern-progress nil))

#+end_src
** Просмотр документа
#+begin_src emacs-lisp
  (use-package doc-view
  :custom
  (doc-view-resolution 300)
  (large-file-warning-threshold (* 50 (expt 2 20))))
#+end_src
** Чтение файлов ePub
#+begin_src emacs-lisp
  (use-package nov
  :init
  (add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode)))
#+end_src
** Управление Библиографией
#+begin_src emacs-lisp

  (defvar ews-bibtex-directory
    (concat (file-name-as-directory (getenv "HOME")) "library"))


  (defvar ews-bibtex-files
    (when (file-exists-p ews-bibtex-directory)
      (directory-files ews-bibtex-directory t "^[A-Z|a-z|0-9].+.bib$"))
    "List of BibTeX files. Use `ews-bibtex-register' to configure.")

  (defun ews-bibtex-register ()
    "Register the contents of the `ews-bibtex-directory' with `ews-bibtex-files`.
  Use when adding or removing a BibTeX file from or to `ews-bibtex-directory'."
    (interactive)
    (when (file-exists-p ews-bibtex-directory)
      (let ((bib-files (directory-files ews-bibtex-directory t
  				      "^[A-Z|a-z|0-9].+.bib$")))
        (setq ews-bibtex-files bib-files
    	    org-cite-global-bibliography bib-files
  	    citar-bibliography bib-files)))
    (message "Registered:\n%s" (mapconcat #'identity ews-bibtex-files "\n")))

  (defun ews--bibtex-combined-biblio-lookup ()
    "Combines `biblio-lookup' and `biblio-doi-insert-bibtex'."
    (require 'biblio)
    (let* ((dbs (biblio--named-backends))
           (db-list (append dbs '(("DOI" . biblio-doi-backend))))
           (db-selected (biblio-completing-read-alist
                         "Backend:"
                         db-list)))
      (if (eq db-selected 'biblio-doi-backend)
          (let ((doi (read-string "DOI: ")))
            (biblio-doi-insert-bibtex doi))
        (biblio-lookup db-selected))))

  (use-package bibtex
    :custom
    (bibtex-user-optional-fields
     '(("keywords" "Keywords to describe the entry" "")
       ("file"     "Relative or absolute path to attachments" "" )))
    (bibtex-align-at-equal-sign t)
    :config
    (ews-bibtex-register)
    :bind
    (("C-c w b r" . ews-bibtex-register)))

#+end_src
** Biblio package for adding BibTeX records
#+begin_src emacs-lisp
  (use-package biblio
  :bind
  ;;(("C-c w b b" . ews-bibtex-biblio-lookup))
  )
#+end_src
** Citar для доступа к библиографиям
#+begin_src emacs-lisp
  (use-package citar
  :defer t
  :custom
  (citar-bibliography ews-bibtex-files)
  :bind
  (("C-c w b o" . citar-open)))
#+end_src
** Читайте RSS-каналы с помощью Elfeed
#+begin_src emacs-lisp
  (use-package elfeed
  :custom
  (elfeed-db-directory
   (expand-file-name "elfeed" user-emacs-directory))
  (elfeed-show-entry-switch 'display-buffer)
  :bind
  ("C-c w e" . elfeed))

;; Configure Elfeed with org mode

(use-package elfeed-org
  :config
  (elfeed-org)
  :custom
  (rmh-elfeed-org-files
   (list (concat (file-name-as-directory (getenv "HOME"))
		 "elfeed.org"))))

#+end_src
** Простая вставка веб-ссылок
#+begin_src emacs-lisp
  (use-package org-web-tools
  :bind
  (("C-c w w" . org-web-tools-insert-link-for-url)))

#+end_src
** Мультимедийная система Emacs
#+begin_src emacs-lisp
  (use-package emms
  :config
  (require 'emms-setup)
  (require 'emms-mpris)
  (emms-all)
  (emms-default-players)
  (emms-mpris-enable)
  :custom
  (emms-browser-covers #'emms-browser-cache-thumbnail-async)
  :bind
  (("C-c w m b" . emms-browser)
   ("C-c w m e" . emms)
   ("C-c w m p" . emms-play-playlist )
   ("<XF86AudioPrev>" . emms-previous)
   ("<XF86AudioNext>" . emms-next)
   ("<XF86AudioPlay>" . emms-pause)))

#+end_src
** Открывать файлы с помощью внешних приложений
#+begin_src emacs-lisp
  (use-package openwith
  :config
  (openwith-mode t)
  :custom
  (openwith-associations nil))
#+end_src
** Мимолетные заметки
#+begin_src emacs-lisp
  (use-package org
  :bind
  (("C-c c" . org-capture)
   ("C-c l" . org-store-link))
  :custom
  (org-goto-interface 'outline-path-completion)
  (org-capture-templates
   '(("f" "Мимолетная заметка"
      item
      (file+headline org-default-notes-file "Notes")
      "- %?")
     ("p" "Постоянное примечание" plain
      (file denote-last-path)
      #'denote-org-capture
      :no-save t
      :immediate-finish nil
      :kill-buffer t
      :jump-to-captured t)
     ("t" "Новая задача" entry
      (file+headline org-default-notes-file "Tasks")
      "* TODO %i%?"))))
#+end_src
** Denote
#+begin_src emacs-lisp
  (use-package denote
  :defer t
  :custom
  (denote-sort-keywords t)
  (denote-link-description-function #'ews-denote-link-description-title-case)
  :hook
  (dired-mode . denote-dired-mode)
  :custom-face
  (denote-faces-link ((t (:slant italic))))
  :bind
  (("C-c w d b" . denote-find-backlink)
   ("C-c w d d" . denote-date)
   ("C-c w d l" . denote-find-link)
   ("C-c w d i" . denote-link-or-create)
   ("C-c w d k" . denote-rename-file-keywords)
   ("C-c w d n" . denote)
   ("C-c w d r" . denote-rename-file)
   ("C-c w d R" . denote-rename-file-using-front-matter)))

(use-package denote-org
  :bind
  (("C-c w d h" . denote-org-link-to-heading)
   ("C-c w d s" . denote-org-extract-org-subtree)))
#+end_src
** Consult convenience functions
#+begin_src emacs-lisp
  (use-package consult
  :bind
  (("C-c w h" . consult-org-heading)
   ("C-c w g" . consult-grep))
  :config
  (add-to-list 'consult-preview-allowed-hooks 'visual-line-mode))
#+end_src

#+begin_src emacs-lisp
  (use-package consult-notes
  :custom
  (consult-notes-denote-display-keywords-indicator "_")
  :bind
  (("C-c w d f" . consult-notes)
   ("C-c w d g" . consult-notes-search-in-all-notes))
  :init
  (consult-notes-denote-mode))
#+end_src

** Citar-Denote to manage literature notes
#+begin_src emacs-lisp
  (use-package citar-denote
  :custom
  (citar-open-always-create-notes t)
  :init
  (citar-denote-mode)
  :bind
  (("C-c w b c" . citar-create-note)
   ("C-c w b n" . citar-denote-open-note)
   ("C-c w b x" . citar-denote-nocite)
   :map org-mode-map
   ("C-c w b k" . citar-denote-add-citekey)
   ("C-c w b K" . citar-denote-remove-citekey)
   ("C-c w b d" . citar-denote-dwim)
   ("C-c w b e" . citar-denote-open-reference-entry)))

#+end_src
** Explore and manage your Denote collection
#+begin_src emacs-lisp
  (use-package denote-explore
  :bind
  (;; Statistics
   ("C-c w x c" . denote-explore-count-notes)
   ("C-c w x C" . denote-explore-count-keywords)
   ("C-c w x b" . denote-explore-barchart-keywords)
   ("C-c w x e" . denote-explore-barchart-filetypes)
   ;; Random walks
   ("C-c w x r" . denote-explore-random-note)
   ("C-c w x l" . denote-explore-random-link)
   ("C-c w x k" . denote-explore-random-keyword)
   ("C-c w x x" . denote-explore-random-regex)
   ;; Denote Janitor
   ("C-c w x d" . denote-explore-identify-duplicate-notes)
   ("C-c w x z" . denote-explore-zero-keywords)
   ("C-c w x s" . denote-explore-single-keywords)
   ("C-c w x o" . denote-explore-sort-keywords)
   ("C-c w x w" . denote-explore-rename-keyword)
   ;; Visualise denote
   ("C-c w x n" . denote-explore-network)
   ("C-c w x v" . denote-explore-network-regenerate)
   ("C-c w x D" . denote-explore-barchart-degree)))

#+end_src
** Написание без отвлекающих факторов
#+begin_src emacs-lisp
  (use-package olivetti
  :demand t
  :bind
  (("C-c w o" . ews-olivetti)))
#+end_src
** Отменить Дерево
#+begin_src emacs-lisp
  (use-package undo-tree
  :config
  (global-undo-tree-mode)
  :custom
  (undo-tree-auto-save-history nil)
  :bind
  (("C-c w u" . undo-tree-visualise)))
#+end_src
** Экспортируйте ссылки в режиме Org
#+begin_src emacs-lisp
  (require 'oc-natbib)
(require 'oc-csl)

(setq org-cite-global-bibliography ews-bibtex-files
      org-cite-insert-processor 'citar
      org-cite-follow-processor 'citar
      org-cite-activate-processor 'citar)

#+end_src
** Поиск слов в онлайн-словарях
#+begin_src emacs-lisp
  (use-package dictionary
    :custom
    (dictionary-server "dict.org")
    :bind
    (("C-c w s d" . dictionary-lookup-definition)))

  (use-package powerthesaurus
    :bind
    (("C-c w s p" . powerthesaurus-transient)))
#+end_src
** Режим Writegood для слов-паразитов, пассивного письма и распознавания повторяющихся слов
#+begin_src emacs-lisp
  (use-package writegood-mode
  :bind
  (("C-c w s r" . writegood-reading-ease))
  :hook
  (text-mode . writegood-mode))
#+end_src

** Изменение названия
#+begin_src emacs-lisp
  (use-package titlecase
  :bind
  (("C-c w s t" . titlecase-dwim)
   ("C-c w s c" . ews-org-headings-titlecase)))
#+end_src
** Abbreviations
#+begin_src emacs-lisp
  (add-hook 'text-mode-hook 'abbrev-mode)
#+end_src
** Lorem Ipsum generator
#+begin_src emacs-lisp
  (use-package lorem-ipsum
  :custom
  (lorem-ipsum-list-bullet "- ") ;; Org mode bullets
  :init
  (setq lorem-ipsum-sentence-separator
        (if sentence-end-double-space "  " " "))
  :bind
  (("C-c w s i" . lorem-ipsum-insert-paragraphs)))
#+end_src
** ediff
#+begin_src emacs-lisp
  (use-package ediff
  :ensure nil
  :custom
  (ediff-keep-variants nil)
  (ediff-split-window-function 'split-window-horizontally)
  (ediff-window-setup-function 'ediff-setup-windows-plain))
#+end_src
** Fountain mode for writing scripts
#+begin_src emacs-lisp
  (use-package fountain-mode)
#+end_src
** Markdown mode
#+begin_src emacs-lisp
  (use-package markdown-mode)
#+end_src
** Общие Настройки экспорта Организации
#+begin_src emacs-lisp
  (use-package org
  :custom
  (org-export-with-drawers nil)
  (org-export-with-todo-keywords nil)
  (org-export-with-toc nil)
  (org-export-with-smart-quotes t)
  (org-export-date-timestamp-format "%e %B %Y"))
#+end_src
** экспорт в epub
#+begin_src emacs-lisp
  (use-package ox-epub
  :demand t
  :init
  (require 'ox-org))
#+end_src
** Настройки экспорта LaTeX в PDF
#+begin_src emacs-lisp
  (use-package ox-latex
  :ensure nil
  :demand t
  :custom
  ;; Multiple LaTeX passes for bibliographies
  (org-latex-pdf-process
   '("pdflatex -interaction nonstopmode -output-directory %o %f"
     "bibtex %b"
     "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
     "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
  ;; Clean temporary files after export
  (org-latex-logfiles-extensions
   (quote ("lof" "lot" "tex~" "aux" "idx" "log" "out"
           "toc" "nav" "snm" "vrb" "dvi" "fdb_latexmk"
           "blg" "brf" "fls" "entoc" "ps" "spl" "bbl"
           "tex" "bcf"))))
#+end_src
** Конфигурация EWS в мягкой обложке
#+begin_src emacs-lisp
  (with-eval-after-load 'ox-latex
  (add-to-list
   'org-latex-classes
   '("ews"
     "\\documentclass[11pt, twoside, hidelinks]{memoir}
      \\setstocksize{9.25in}{7.5in}
      \\settrimmedsize{\\stockheight}{\\stockwidth}{*}
      \\setlrmarginsandblock{1.5in}{1in}{*} 
      \\setulmarginsandblock{1in}{1.5in}{*}
      \\checkandfixthelayout
      \\layout
      \\setcounter{tocdepth}{0}
      \\setsecnumdepth{subsection}
      \\renewcommand{\\baselinestretch}{1.2}
      \\setheadfoot{0.5in}{0.75in}
      \\setlength{\\footskip}{0.8in}
      \\chapterstyle{bianchi}
      \\renewcommand{\\beforechapskip}{-30pt}
      \\setsecheadstyle{\\normalfont \\raggedright \\textbf}
      \\setsubsecheadstyle{\\normalfont \\raggedright \\emph}
      \\setsubsubsecheadstyle{\\normalfont\\centering}
      \\pagestyle{myheadings}
      \\usepackage[font={small, it}]{caption}
      \\usepackage{ccicons}
      \\usepackage{ebgaramond}
      \\usepackage[authoryear]{natbib}
      \\bibliographystyle{apalike}
      \\usepackage{svg}
      \\hyphenation{mini-buffer}
      \\renewcommand{\\LaTeX}{LaTeX}
      \\renewcommand{\\TeX}{TeX}"
     ("\\chapter{%s}" . "\\chapter*{%s}")
     ("\\section{%s}" . "\\section*{%s}")
     ("\\subsection{%s}" . "\\subsection*{%s}")
     ("\\subsubsection{%s}" . "\\subsubsection*{%s}"))))
#+end_src
** Команда привязки организационной повестки дня и пользовательская повестка дня
#+begin_src emacs-lisp
  (use-package org
  :custom
  (org-agenda-custom-commands
   '(("e" "Agenda, next actions and waiting"
      ((agenda "" ((org-agenda-overriding-header "Next three days:")
                   (org-agenda-span 3)
                   (org-agenda-start-on-weekday nil)))
       (todo "NEXT" ((org-agenda-overriding-header "Next Actions:")))
       (todo "WAIT" ((org-agenda-overriding-header "Waiting:")))))))
  :bind
  (("C-c a" . org-agenda)))
#+end_src
** Управление файлами
#+begin_src emacs-lisp
  (use-package dired
    :ensure
    nil
    :commands
    (dired dired-jump)
    :custom
  (dired-listing-switches
   "-goah --group-directories-first --time-style=long-iso")
  (dired-dwim-target t)
  (delete-by-moving-to-trash t)
  :init
  (put 'dired-find-alternate-file 'disabled nil))
#+end_src
Скрывать или отображать скрытые файлы
#+begin_src emacs-lisp
  (use-package dired
    :ensure nil
    :hook (dired-mode . dired-omit-mode)
    :bind (:map dired-mode-map
                ( "."     . dired-omit-mode))
    :custom (dired-omit-files "^\\.[a-zA-Z0-9]+"))

#+end_src
** Резервные копии файлов
#+begin_src emacs-lisp
  (setq-default backup-directory-alist
              `(("." . ,(expand-file-name "backups/" user-emacs-directory)))
              version-control t
              delete-old-versions t
              create-lockfiles nil)
#+end_src
** Последние файлы
#+begin_src emacs-lisp
  (use-package recentf
  :config
  (recentf-mode t)
  :custom
  (recentf-max-saved-items 50)
  :bind
  (("C-c w r" . recentf-open)))
#+end_src
** bookmark
#+begin_src emacs-lisp
  (use-package bookmark
  :custom
  (bookmark-save-flag 1)
  :bind
  ("C-x r d" . bookmark-delete))
#+end_src
** Средство просмотра изображений
#+begin_src emacs-lisp
  (use-package emacs
  :custom
  (image-dired-external-viewer "gimp")
  :bind
  ((:map image-mode-map
         ("k" . image-kill-buffer)
         ("<right>" . image-next-file)
         ("<left>"  . image-previous-file))
   (:map dired-mode-map
         ("C-<return>" . image-dired-dired-display-external))))

(use-package image-dired
  :bind
  (("C-c w I" . image-dired))
  (:map image-dired-thumbnail-mode-map
        ("C-<right>" . image-dired-display-next)
        ("C-<left>"  . image-dired-display-previous)))

#+end_src
** org-babel
#+begin_src emacs-lisp
  ;; GraphViz for flow diagrams
;; requires GraphViz software
(org-babel-do-load-languages
 'org-babel-load-languages
 '((dot . t)))
#+end_src
** Меню
#+begin_src emacs-lisp
    (use-package major-mode-hydra
    :ensure t
    :bind
    ("C-c n" . major-mode-hydras/menu-main/body)
    ;;("C-c n a" . major-mode-hydra)
    )
#+end_src
*** main menu
#+begin_src emacs-lisp
  (major-mode-hydra-define menu-main nil
  ("File"
   (("q" nil "Закрыть меню")
    )
   "Notes"
   (("n" eval-buffer "Заметки")
    ("e" eval-defun "defun")
    ("r" eval-region "region"))
   
  ))

  (global-set-key (kbd "C-n") #'major-mode-hydras/menu-main/body)
  
#+end_src
